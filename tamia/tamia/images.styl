// Tâmia © 2015 Artem Sapegin http://sapegin.me
// Images, sprites, Retina support

//
// Configuration
//

// Enable Retina support (default: false).
retinafy ?= false

// Path to calculate file system image path based on CSS path (default: .).
images_relative_root ?= '.'

// Sprite fingerprint, string that will be appended to URL to flush browser cache.
sprite_fingerprint ?= null

// Default sprite image file (default: ../build/sprite.png).
// Sprite should be generated by [grunt-tamia-sprite](https://github.com/tamiadev/grunt-tamia-sprite).
sprite_image ?= '../build/sprite.png'
sprite_image = sprite_image + '?' + sprite_fingerprint  if sprite_fingerprint


//
// Functions
//

// background-image with Retina variant.
//
// path - Image file path.
// x - background-position x (default: 0).
// y - background-position y (default: 0).
//
// Retina image file should be named path@2x.png.
image(path, x=0, y=0)
	if retinafy
		background: url(path) x y
		+retina()
			ext = extname(path)
			hdpath = dirname(path) + '/' + basename(path, ext) + '@2x' + ext
			background: url(hdpath) x y
			background-size: image-size(pathjoin(images_relative_root, path))
	else
		background: url(path) x y


// Sprite (to use in pseudo element).
//
// img - Sprite image variable.
//
// Example:
//
//   .elem
//     sprite(sprite_pony);
sprite(img)
	if not @content and match(":(before|after)", selector())
		content: ""
	if not @display
		display: inline-block
	image(sprite_image, img[0], img[1])
	width: img[2]
	height: img[3]

// background-position for sprite.
//
// img - Sprite image variable.
//
// Example:
//
//   .elem
//     sprite-bg()
//     sprite-pos(sprite_pony-hover)
sprite-pos(img)
	background-position: img[0] img[1]

// background-image for sprite.
sprite-bg()
	image(sprite_image)

// Element width for sprite.
//
// img - Sprite image variable.
//
// Returns pixels
sprite-width(img)
	img[2]

// Element height for sprite.
//
// img - Sprite image variable.
//
// Returns pixels
sprite-height(img)
	img[3]

// Element width/height for sprite.
//
// img - Sprite image variable.
//
// Example:
//
//   .elem
//     sprite-size(sprite_pony);
sprite-size(img)
	width: sprite-width(img)
	height: sprite-height(img)

// Shifts element half height to top.
//
// img - Sprite image variable.
sprite-shift-top(img)
	margin-top: (-(round(sprite-height(img)/2)))
